<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Migrate from WordTour to OpenMusicFestival - My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yoursite.com/blog/2013/04/09/migrate-wordtour-openmusicfestival">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  

</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">My Octopress Blog</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="search navbar-form navbar-right" action="http://google.com/search" method="GET">
                    <input type="hidden" name="q" value="site:yoursite.com">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <article class="hentry" role="article">
      
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-04-09T12:45:53+01:00" pubdate data-updated="true">Apr 9<span>th</span>, 2013</time>
        
      </p>
    
    
    <h1 class="entry-title">
        Migrate From WordTour to OpenMusicFestival
        
    </h1>
    
  </header>


<div class="entry-content clearfix"><p>The reason I created [OpenMusicFestival](<a href="http://www.openmusicfestival.com">http://www.openmusicfestival.com</a>) in the first place was so that I could migrate [MotionNotion.com](<a href="http://www.motionnotion.com">http://www.motionnotion.com</a>) from WordPress (And its unsupported WordTour plugin) to Drupal 7. While I suspect my original use of WordTour for a music festival was slightly weird (The system was designed for small record labels, but relationship between artists, events and venues made it work for my purposes), I&rsquo;m releasing my Artist migration class in case somebody finds it useful and wants to migrate to OpenMusicFestival. Note that this only migrates Artists — the Event and Venues parts are incomplete (On that note, if somebody wants to do those, I&rsquo;ll happily both give you credit on the project as well as include the code with OMF.). ~~~</p>

<p>&lt;?php
/<em><em>
 * @file
 *  Migrate content from WordTour (WP) to OMF (Drupal)
 *
 *  NOTE: THIS IS WOEFULLY INCOMPLETE. I would </em>love</em> to give somebody credit
 *  for tidying up and completing this.
 */</p>

<p>class WordTourMigration extends Migration {
  public $wp_prefix = &lsquo;wp_&rsquo;; //This is the entire first part of the table name.
  public $wp_db = &lsquo;&rsquo;;
  public $wp_user = &lsquo;&rsquo;;
  public $wp_pass = &lsquo;&rsquo;;
  public $wp_host = &lsquo;localhost&rsquo;;</p>

<p>  public function __construct() {</p>

<pre><code>// Always call the parent constructor first for basic setup
parent::__construct();

// With migrate_ui enabled, migration pages will indicate people involved in
// the particular migration, with their role and contact info. We default the
// list in the shared class; it can be overridden for specific migrations.
$this-&gt;team = array( new MigrateTeamMember('Ændrew Rininsland', 'aendrew@aendrew.com', t('Developer')), ); // Individual mappings in a migration can be linked to a ticket or issue // in an external tracking system. Define the URL pattern here in the shared // class with ':id:' representing the position of the issue number, then add // -&gt;issueNumber(1234) to a mapping. $this-&gt;issuePattern = 'http://drupal.org/node/:id:'; } } /\** *| There are four essential components to set up in your constructor: * $this-&gt;source - An instance of a class derived from MigrateSource, this * will feed data to the migration. * $this-&gt;destination - An instance of a class derived from MigrateDestination, * this will receive data that originated from the source and has been mapped * by the Migration class, and create Drupal objects. * $this-&gt;map - An instance of a class derived from MigrateMap, this will keep * track of which source items have been imported and what destination objects * they map to. * Mappings - Use $this-&gt;addFieldMapping to tell the Migration class what source * fields correspond to what destination fields, and additional information * associated with the mappings. */ class ArtistMigration extends WordTourMigration { public function \_\_construct() { parent::\_\_construct(); //Set up other database Database::addConnectionInfo('wp', 'default', array( 'driver' =&gt; 'mysql', 'database' =&gt; $this-&gt;wp\_db, 'username' =&gt; $this-&gt;wp\_user, 'password' =&gt; $this-&gt;wp\_pass, 'host' =&gt; $this-&gt;wp\_host, 'prefix' =&gt; $this-&gt;wp\_prefix, )); $this-&gt;description = t('Migrate the artists!'); $this-&gt;map = new MigrateSQLMap($this-&gt;machineName, array( 'artist\_id' =&gt; array( 'type' =&gt; 'int', 'length' =&gt; 7, 'not null' =&gt; TRUE, 'description' =&gt; 'Artist ID', ) ), MigrateDestinationNode::getKeySchema() ); $query = Database::getConnection('default', 'wp') -&gt;select('wtr\_artists', 'a'); $query-&gt;join('wtr\_attachment', 'at', 'a.artist\_id = at.attachment\_target\_id'); $query-&gt;join('wtr\_attachment', 'att', 'a.artist\_id = att.attachment\_target\_id'); $query-&gt;join('postmeta', 'pm', 'pm.post\_id = att.attachment\_type\_id'); $query-&gt;fields('a', array( 'artist\_id', 'artist\_name', 'artist\_publish\_date', 'artist\_bio', 'artist\_record\_company', 'artist\_social\_links', ) ); //$query-&gt;fields('att', array('attachment\_info')); $query-&gt;fields('pm', array('meta\_value')); //$query-&gt;addField('pm', 'meta\_value', 'photo'); $query-&gt;addExpression('GROUP\_CONCAT(DISTINCT at.attachment\_info)', 'genres'); //Pull in genres. $query-&gt;condition('at.attachment\_target', 'artist'); $query-&gt;condition('at.attachment\_type', 'genre'); $query-&gt;condition('att.attachment\_type', 'thumbnail'); $query-&gt;condition('pm.meta\_key', '\_wp\_attached\_file'); $query-&gt;groupBy('a.artist\_id'); // Create a MigrateSource object, which manages retrieving the input data. $this-&gt;source = new MigrateSourceSQL($query, array(), NULL, array('map\_joinable' =&gt; FALSE)); // Set up our destination $this-&gt;destination = new MigrateDestinationNode('artist', array('text\_format' =&gt; 'full\_html')); // Assign mappings TO destination fields FROM source fields. $this-&gt;addFieldMapping('title', 'artist\_name'); $this-&gt;addFieldMapping('uid') -&gt;defaultValue(1); $this-&gt;addFieldMapping('changed', 'artist\_publish\_date'); $this-&gt;addFieldMapping('status') -&gt;defaultValue(1); $this-&gt;addFieldMapping('promote', '') -&gt;defaultValue(0); $this-&gt;addFieldMapping('sticky', '') -&gt;defaultValue(0); $this-&gt;addFieldMapping('revision') -&gt;defaultValue(0); $this-&gt;addFieldMapping('log') -&gt;defaultValue('Migrated to Drupal 7 from WordPress.'); $this-&gt;addFieldMapping('comment') -&gt;defaultValue(1); $this-&gt;addFieldMapping('body', 'artist\_bio') -&gt;arguments(array('format' =&gt; 'full\_html')) -&gt;description('See prepareRow()'); $this-&gt;addFieldMapping('created', 'artist\_publish\_date'); $this-&gt;addFieldMapping('field\_labels', 'artist\_record\_company') -&gt;separator(', ') -&gt;arguments(array('create\_term' =&gt; true)); //$this-&gt;addFieldMapping('path', ''); //$this-&gt;addFieldMapping('pathauto', ''); $this-&gt;addFieldMapping('field\_photo', 'meta\_value'); $this-&gt;addFieldMapping('field\_photo:source\_dir') -&gt;defaultValue('/Users/aendrew/Sites/mn\_wp'); $this-&gt;addFieldMapping('field\_photo:preserve\_files') -&gt;defaultValue(true); $this-&gt;addFieldMapping('field\_photo:destination\_file', 'meta\_value'); $this-&gt;addFieldMapping('field\_photo:file\_replace') -&gt;defaultValue(MigrateFile::FILE\_EXISTS\_REUSE); $this-&gt;addFieldMapping('field\_photo:alt', 'artist\_name'); $this-&gt;addFieldMapping('field\_photo:title', 'artist\_name'); $this-&gt;addFieldMapping('field\_links', 'artist\_social\_links') -&gt;description('See prepare()'); //Needs to be unserialized $this-&gt;addFieldMapping('field\_genres', 'genres') -&gt;separator(',') -&gt;arguments(array('create\_term' =&gt; true)); } public function prepareRow($row) { //Prepare Thumbnails $thumb = trim($row-&gt;meta\_value); //watchdog('migrate', 'Filename is ' . $thumb); $row-&gt;meta\_value = 'wp-content/uploads/' . $thumb; } public function prepare(stdClass $node, stdClass $row) { //Set up the links $links = unserialize($row-&gt;artist\_social\_links); $empty = 'a:10:{s:13:"artist\_flickr";s:0:"";s:14:"artist\_youtube";s:0:"";s:12:"artist\_vimeo";s:0:"";s:15:"artist\_facebook";s:0:"";s:14:"artist\_twitter";s:0:"";s:13:"artist\_lastfm";s:0:"";s:14:"artist\_myspace";s:0:"";s:15:"artist\_bandcamp";s:0:"";s:13:"artist\_tumblr";s:0:"";s:19:"artist\_reverbnation";s:0:"";}'; if ($node-&gt;field\_links\[LANGUAGE\_NONE\]\[0\]\['url'] == $empty) { unset($node-&gt;field\_links); } else { $i = 0; foreach ($links as $site =&gt; $link) { if (!empty($link)) { $site\_name = ucfirst(str\_replace('artist\_', '', $site)); if ($site\_name == "Youtube") $site\_name = "YouTube"; if ($site\_name == "Lastfm") $site\_name = "Last.fm"; if ($site\_name == "Youtube") $site\_name = "YouTube"; if ($site\_name == "Myspace") $site\_name = "MySpace"; $node-&gt;field\_links[LANGUAGE\_NONE\]\[$i\]\['title'] = $site\_name; $node-&gt;field\_links[LANGUAGE\_NONE\]\[$i\]['url'] = urldecode($link); $i++; } } } } } ~~~ Did this help you out? Have I saved you a tonne of time? Please leave me a comment letting me know!
</code></pre>
</div>


      <footer>
        <p class="meta text-muted">
          
  

<span class="glyphicon glyphicon-user"></span> <span class="byline author vcard">Posted by <span class="fn">Your Name</span></span>

          












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-04-09T12:45:53+01:00" pubdate data-updated="true">Apr 9<span>th</span>, 2013</time>
          


        </p>
        
          <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://yoursite.com/blog/2013/04/09/migrate-wordtour-openmusicfestival/" data-via="" data-counturl="http://yoursite.com/blog/2013/04/09/migrate-wordtour-openmusicfestival/" >Tweet</a>
  
  
  
</div>

        
        
          <ul class="meta text-muted pager">
            
            <li class="previous"><a href="/blog/2013/03/11/podsix-lives/" title="Previous Post: PodSix lives!">&laquo; PodSix lives!</a></li>
            
            
          </ul>
        
      </footer>
    </article>
    
  </div>

  
  <aside class="sidebar col-md-3">
    
      <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item active" href="/blog/2013/04/09/migrate-wordtour-openmusicfestival/">Migrate From WordTour to OpenMusicFestival</a>
    
    <a class="list-group-item " href="/blog/2013/03/11/podsix-lives/">PodSix Lives!</a>
    
    <a class="list-group-item " href="/blog/2013/03/10/new-project-github-pages-drupal-7-also-im-git-vetted/">New Project: GitHub Pages for Drupal 7 (Also: I'm Git Vetted!)</a>
    
    <a class="list-group-item " href="/blog/2013/02/18/new-project-openmusicfestival/">New Project: OpenMusicFestival</a>
    
    <a class="list-group-item " href="/blog/2013/01/24/help-me-launch-visualization-groupsdrupalorg/">Help Me Launch Visualization on groups.drupal.org!</a>
    
  </div>
</section>






    
  </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2014 - Your Name<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>








  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </body>
</html>
